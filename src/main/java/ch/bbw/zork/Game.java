package ch.bbw.zork;import java.util.*;public class Game {	private Player player;	private Parser parser;	private Room outside, waiting_room, laboratory, hall, patient_room, balcony, operation_room, currentRoom;	private Item fist;	private Enemy zombie, fat_zombie, nurse, doctor;	private static final Random random = new Random();	private Stack<Room> roomHistory;	public Game() {		parser = new Parser(System.in);		fist = new Item("Fist", "Your own fist", 1.0, 100, 0.5, null, 0, true);		Item[] Inventory = {fist};		roomHistory = new Stack<>();		roomHistory.push(currentRoom);		outside = new Room("outside the ruined Hospital", 0, spawnEnemies());		waiting_room = new Room("the waiting room. Something tells you not to stay too long...", 1, spawnEnemies());		balcony = new Room("the balcony. you can see the city in ruins", 2, spawnEnemies());		laboratory = new Room("laboratory, a room where research is done to patients", 3, spawnEnemies());		hall = new Room("the hall. This hall is very long...", 4, spawnEnemies());		patient_room = new Room("patient room... it gives you chills", 5, spawnEnemies());		operation_room = new Room("Last room in this floor...", 6, spawnEnemies());		// Set the exits for each room		outside.setExits(null, waiting_room, null, null);		waiting_room.setExits(null, balcony, null, outside);		balcony.setExits(null, null, null, waiting_room);		laboratory.setExits(null, hall, operation_room, null);		hall.setExits(waiting_room, null, patient_room, laboratory);		patient_room.setExits(hall, null, null, null);		operation_room.setExits(laboratory, null, null, null);		currentRoom = outside ; // start the game in the hall		roomHistory.push(currentRoom); // Now push the current room onto the stack		// Create the player's inventory with some starting items		player = new Player(100, "PlayerName", currentRoom.getRoomId(), currentRoom.getRoomId(), Inventory);	}	public void play() {		printWelcome();		boolean finished = false;		while (!finished) {			Command command = parser.getCommand();			finished = processCommand(command);		}		System.out.println("Thank you for playing.  Good bye.");	}	private void printWelcome() {		System.out.println();		System.out.println("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~");		System.out.println("In this cold, cold world, where the ");		System.out.println("Apocalypse came true, everything is trying");		System.out.println("to kill you... You wandered alone ");		System.out.println("into an abandoned Hospital.");		System.out.println("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~");		System.out.println();		// Print the room description		System.out.println(currentRoom.longDescription());		// Print information about enemies in the room		printenemies();	}	public void printenemies(){		Enemy[] enemies = currentRoom.getEnemies();		if (enemies != null && enemies.length > 0) {			System.out.println("You see the following enemies in the room:");			for (int i = 0; i < enemies.length; i++) {				System.out.println((i + 1) + ". " + enemies[i].getDescription());			}		} else {			System.out.println("There are no enemies in the room.");		}	}	private boolean processCommand(Command command) {		if (command.isUnknown()) {			System.out.println("I don't know what you mean...");			return false;		}		String commandWord = command.getCommandWord();		switch (commandWord) {			case "help":				printHelp();				break;			case "win":				System.out.println();				System.out.println();				System.out.println("wow you won!");				System.out.println();				System.out.println();				return true;			case "say":				System.out.println(command.getSecondWord());				break;			case "use":				if (command.hasSecondWord()) {					try {						int itemIndex = Integer.parseInt(command.getSecondWord()) - 1; // Adjust index to start from 0						Item itemToUse = player.findItemByIndex(itemIndex);						if (itemToUse != null) {							// Implement the logic for using the item here							selectItem(itemToUse); // For example, select the item for use							System.out.println("You selected the " + itemToUse.getName() + "!");						} else {							System.out.println("You can't find that item in your inventory.");						}					} catch (NumberFormatException e) {						System.out.println("Invalid item index. Use 'use' followed by the item number.");					}				} else {					System.out.println("Use what? Specify the item number.");				}				break;			case "get":				generateRandomItem();				break;			case "go":				goRoom(command);				break;			case "inv":				printInventory();				break;			case "back":				goBack();				break;			case "map":				printMap(currentRoom.getRoomId());				break;			case "search":				searchRoom();				break;			case "fight":				if (command.hasSecondWord()) {					String enemyNumber = command.getSecondWord();					if (isNumeric(enemyNumber)) {						int enemyIndex = Integer.parseInt(enemyNumber) - 1; // Adjust index to start from 0						Enemy[] enemies = currentRoom.getEnemies();						if (enemyIndex >= 0 && enemyIndex < enemies.length) {							fightEnemy(enemies[enemyIndex]); // Fight the specified enemy						} else {							System.out.println("Invalid enemy number. Please specify a valid enemy number.");						}					} else {						System.out.println("Invalid enemy number. Please specify a valid enemy number.");					}				} else {					System.out.println("Fight which enemy? Specify the enemy number.");				}				break;			case "drop":				if (command.hasSecondWord()) {					String indexOrName = command.getSecondWord();					if (isNumeric(indexOrName)) {						int index = Integer.parseInt(indexOrName) - 1;						if (index >= 0 && index < player.getInventory().length) {							Item itemToDrop = player.findItemByIndex(index);							player.removeFromInventory(itemToDrop);							System.out.println("You dropped the " + itemToDrop.getName());						} else {							System.out.println("Invalid item index. Check your inventory and try again.");						}					} else {						// If it's not a number, try to drop the item by name						Item itemToDrop = player.findItemByName(indexOrName);						if (itemToDrop != null) {							player.removeFromInventory(itemToDrop);							System.out.println("You dropped the " + itemToDrop.getName());						} else {							System.out.println("You don't have an item with that name in your inventory.");						}					}				} else {					System.out.println("Drop what? Specify the item number or name.");				}				break;			case "quit":				if (command.hasSecondWord()) {					System.out.println("Quit what?");				} else {					return true; // signal that we want to quit				}				break;		}		return false;	}	private void printHelp() {		System.out.println();		System.out.println("Your command words are:");		System.out.println(parser.showCommands());		System.out.println("You have " + player.getHp() + "HP");		System.out.println(getCurrentWeaponInfo());		System.out.println();		printenemies();		System.out.println("Good luck, soldier");	}	private void printInventory() {		// Access the inventory through the player instance		List<Item> playerInventory = List.of(player.getInventory());		if (playerInventory != null && !playerInventory.isEmpty()) {			System.out.println("You look through your inventory.");			System.out.println("Inside you have:");			for (Item item : playerInventory) {				String star = item.isHasStar() ? "â˜…" : ""; // Add a star if the item has a star				System.out.println(star + " " + item.getName());			}		} else {			System.out.println("Your inventory is empty.");		}	}	public void fightEnemy(Enemy enemy) {		int playerDamage = getCurrentWeaponDamage(); // Get the damage of the current weapon		while (player.getHp() > 0 && enemy.getHealth() > 0) {			int enemyDamage = enemy.getDamage();			// Calculate and apply damage			enemy.takeDamage(playerDamage);			player.takeDamage(enemyDamage);			System.out.println();			System.out.println("You attack the " + enemy.getName() + " and deal " + playerDamage + " damage.");			System.out.println("The " + enemy.getName() + " attacks you and deals " + enemyDamage + " damage.");			System.out.println();			System.out.println("Your health: " + player.getHp() + " HP");			System.out.println(enemy.getName() + " health: " + enemy.getHealth() + " HP");		}		if (player.getHp() <= 0) {			System.out.println("You have been defeated. Game over.");		} else {			System.out.println("You defeated the " + enemy.getName() + "!");			currentRoom.removeEnemy(enemy);			System.out.println();			generateRandomItem(); // reward system!			System.out.println();			printenemies();		}	}	public void goRoom(Command command) {		if (!command.hasSecondWord()) {			System.out.println("Go where?");		} else {			String direction = command.getSecondWord();			Room nextRoom = currentRoom.nextRoom(direction);			if (nextRoom == null)				System.out.println("There is no door that way!");			else {				roomHistory.push(currentRoom); // Push the current room onto the stack				currentRoom = nextRoom;				System.out.println(currentRoom.longDescription());				currentRoom.setEnemies(spawnEnemies()); // Update the room's enemies when entering a new room				printenemies(); // Print information about enemies in the room			}		}	}	public void printMap(int roomID) {		System.out.println("+--------------+        +--------------+        +--------------+");		System.out.println("|              |        |              |        |              |");		System.out.println("|   Outside    |--------| Waiting room |--------|    Balcony   |");		System.out.println("|              |        |              |        |              |");		System.out.println("+--------------+        +--------------+        +--------------+");		System.out.println("                               |");		System.out.println("                               |");		System.out.println("+--------------+        +--------------+");		System.out.println("|              |        |              |");		System.out.println("|  Laboratory  |--------|     Hall     |");		System.out.println("|              |        |              |");		System.out.println("+--------------+        +--------------+");		System.out.println("       |                       |");		System.out.println("       |                       |");		System.out.println("+--------------+        +--------------+");		System.out.println("|              |        |              |");		System.out.println("|Operation room|        | Patient room |");		System.out.println("|              |        |              |");		System.out.println("+--------------+        +--------------+");		String wherePlayerIs;		switch (roomID) {			case 0:				wherePlayerIs = "Outside.";				break;			case 1:				wherePlayerIs = "in the Waiting room.";				break;			case 2:				wherePlayerIs = "on the Balcony.";				break;			case 3:				wherePlayerIs = "in the Laboratory.";				break;			case 4:				wherePlayerIs = "in the Hall.";				break;			case 5:				wherePlayerIs = "in the Operation room.";				break;			case 6:				wherePlayerIs = "in the Patients room.";				break;			default:				throw new IllegalStateException("Unexpected value: " + roomID);		}		System.out.println("You are currently " + wherePlayerIs);	}	public void generateRandomItem() {		String[] itemNames = {"Needle", "Scalpel", "Syringe", "Stethoscope", "Tweezer", "Forceps", "Medical Hammer", "Blood Pressure Cuff", "Thermometer"};		String name = itemNames[random.nextInt(itemNames.length)];		String description = "Description of " + name;		double damage = random.nextDouble() * 10;		int durability = random.nextInt(10) + 1;		double weight = random.nextDouble() * 2;		String[] perks = null;		int hp = random.nextInt(10) + 1;		Item randomItem = new Item(name, description, damage, durability, weight, perks, hp, false);		player.addToInventory(randomItem);		System.out.println("You found a " + name + "!");	}	public void selectItem(Item item2Bselected) {		removeStarsFromAllItems();		item2Bselected.setHasStar(true);	}	public void removeStarsFromAllItems() {		for (Item item : player.getInventory()) {			if (item.isHasStar()) {				item.setHasStar(false); // Remove the star from the item			}		}	}	public void searchRoom() {		if (currentRoom.isSearched()) {			System.out.println("Dieser Raum wurde schon gesucht.");		} else {			currentRoom.setSearched(true);			generateRandomItem();		}	}	public boolean isNumeric(String str) {		try {			Double.parseDouble(str);			return true;		} catch (NumberFormatException e) {			return false;		}	}	public void goBack() {		if (roomHistory.size() >= 2) {			roomHistory.pop(); // Remove the current room			currentRoom = roomHistory.peek(); // Get the previous room			System.out.println("You go back to the previous room.");			System.out.println(currentRoom.longDescription());		} else if (roomHistory.size() == 1) {			// If there's only one room in the history stack, you're already at the starting room			System.out.println("You can't go back further. You are already at the starting room.");		} else {			System.out.println("There's nowhere to go back to. You haven't visited any rooms yet.");		}	}	public Enemy[] spawnEnemies() {		int numEnemies = random.nextInt(3) + 1; // Generates a random number between 1 and 3		Enemy[] enemies = new Enemy[numEnemies];		for (int i = 0; i < numEnemies; i++) {			String[] enemyNames = {"Zombie", "Fat Zombie", "Nurse", "Doctor"};			String name = enemyNames[random.nextInt(enemyNames.length)];			String description;			int damage;			int health;			boolean isBoss = false;			switch (name) {				case "Zombie":					description = "A slow-moving, reanimated corpse. It looks like it's hungry for your brains.";					damage = 1; // Adjust the damage value as needed					health = 10; // Adjust the health value as needed					isBoss = false;					break;				case "Fat Zombie":					description = "A slower, more resilient zombie. It has a menacing appearance.";					damage = 2; // Adjust the damage value as needed					health = 15; // Adjust the health value as needed					isBoss = false;					break;				case "Nurse":					description = "An infected nurse in tattered scrubs. Her eyes are bloodshot, and she's carrying a syringe.";					damage = 4; // Adjust the damage value as needed					health = 15; // Adjust the health value as needed					isBoss = false;					break;				case "Doctor":					description = "A crazed doctor with a bloodied lab coat. He's wielding a sharp scalpel.";					damage = 12; // Adjust the damage value as needed					health = 12; // Adjust the health value as needed					isBoss = true;					break;				default:					// Handle any other cases or provide default values					description = "A generic enemy.";					damage = 10;					health = 50;			}			enemies[i] = new Enemy(name, damage, health, isBoss, description);		}		return enemies;	}	public int getCurrentWeaponDamage() {		for (Item item : player.getInventory()) {			if (item.isHasStar()) {				return (int) item.getDamage();			}		}		return (int) fist.getDamage();	}	public String getCurrentWeaponInfo() {		for (Item item : player.getInventory()) {			if (item.isHasStar()) {				return "You are using a " + item.getDescription() + ", which does " + item.getDamage() + " Damage and has " + item.getDurability() + " Durability.";			}		}		// Return a default message when no starred items are found		return "You are currently unarmed.";	}}